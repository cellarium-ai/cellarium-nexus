{% extends "admin/base.html" %}
{% load admin_urls i18n unfold static %}

{% block breadcrumbs %}{% if not is_popup %}
  <div class="px-4">
    <div class="container mb-6 mx-auto -my-3 lg:mb-12">
      <ul class="flex flex-wrap">
        {% url 'admin:index' as link %}
        {% trans 'Home' as name %}
        {% include 'unfold/helpers/breadcrumb_item.html' with link=link name=name %}

        {% trans 'Cell Information' as name %}
        {% include 'unfold/helpers/breadcrumb_item.html' with name=name link='' %}
      </ul>
    </div>
  </div>
{% endif %}{% endblock %}

{% block content %}
  <div class="px-4">
    <div class="container mx-auto">
      <h1 class="mb-4 text-2xl font-bold"> Cell Omics Data </h1>

      <!-- Dataset selector (mocked) -->
      <div class="mb-6">
        <div id="dataset-selector" class="flex flex-wrap gap-3 justify-start max-h-80 overflow-y-auto">
          {% for ds in datasets %}
            {% if ds.name == selected_dataset %}
              <button
                type="button"
                class="dataset-card flex w-auto items-center justify-center rounded-lg px-4 py-2 text-center font-medium shadow-sm border border-primary-600 bg-primary-50 text-primary-800 ring-1 ring-primary-600 dark:bg-primary-900/20 dark:text-primary-300"
                aria-selected="true"
                data-dataset="{{ ds.name }}"
                data-description="{{ ds.description|default:'' }}"
              >
                {{ ds.name }}
              </button>
            {% else %}
              <button
                type="button"
                class="dataset-card flex w-auto items-center justify-center rounded-lg px-4 py-2 text-center font-medium shadow-sm border border-base-200 hover:border-primary-400 dark:border-base-800 dark:hover:border-primary-600"
                aria-selected="false"
                data-dataset="{{ ds.name }}"
                data-description="{{ ds.description|default:'' }}"
              >
                {{ ds.name }}
              </button>
            {% endif %}
          {% endfor %}
        </div>
        <p id="selected-dataset-description" class="mt-2 text-sm text-base-500 dark:text-base-400"></p>
        <button id="dataset-desc-toggle" type="button" class="inline-flex items-center gap-1 bg-transparent border-0 p-0">Show more</button>
      </div>

      {# Include filters block here #}
      {% include 'admin/cell_management/cellinfo/filters.html' %}

      <hr class="border-base-200 dark:border-base-800 my-8" />

      <!-- Results summary (mocked, mirrors changelist results) -->
      <div class="flex flex-col items-center justify-center text-muted-foreground py-10 space-y-4">
        <span class="material-symbols-outlined text-gray-500" style="font-size: 150px;">science</span>
        <h2 class="text-center font-extrabold tracking-tight" style="font-size: 50px; line-height: 1.1;">
          ðŸ¦  <span id="cell-count">0</span> Cells
        </h2>
        <p class="text-lg text-gray-400 text-center max-w-md">
          {% trans "in the Data Store by selected filters" %}
        </p>
        <a href="#"
           class="bg-primary-600 border-primary-600 text-white border cursor-pointer flex items-center gap-2 font-medium px-3 py-2 rounded shadow-sm text-sm">
          <span class="material-symbols-outlined text-base">menu_book</span>
          {% trans "Extract Curriculum" %}
        </a>
      </div>
    </div>
  </div>
{% endblock %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'admin/cell_management/cellinfo/css/filters.css' %}">
{% endblock %}

{% block footer %}
  {{ block.super }}
  {# Provide counts mapping as JSON in a safe script tag #}
  {{ dataset_counts|json_script:"dataset-counts" }}
  {# Provide fields metadata so the frontend can initialize without an API call #}
  {{ filters_fields_meta|json_script:"filters-fields-meta" }}
  {# Provide precomputed maps for all datasets to enable instant switching #}
  {{ precomputed_categorical_columns_all|json_script:"precomputed-categorical-columns-all" }}
  {{ precomputed_suggestions_all|json_script:"precomputed-suggestions-all" }}
  <script src="{% static 'admin/cell_management/cellinfo/js/cell_info.js' %}"></script>
  <script src="{% static 'admin/cell_management/cellinfo/js/filters.constants.js' %}"></script>
  <script src="{% static 'admin/cell_management/cellinfo/js/filters.meta.js' %}"></script>
  <script src="{% static 'admin/cell_management/cellinfo/js/filters.select2.js' %}"></script>
  <script src="{% static 'admin/cell_management/cellinfo/js/filters.utils.js' %}"></script>
  <script src="{% static 'admin/cell_management/cellinfo/js/filters.widgets.js' %}"></script>
  <script src="{% static 'admin/cell_management/cellinfo/js/filters.rows.core.js' %}"></script>
  <script src="{% static 'admin/cell_management/cellinfo/js/filters.rows.state.js' %}"></script>
  <script src="{% static 'admin/cell_management/cellinfo/js/filters.apply.js' %}"></script>
  <script src="{% static 'admin/cell_management/cellinfo/js/filters.js' %}"></script>
{% endblock %}
